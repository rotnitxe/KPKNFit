<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">

    <title>KPKN</title>
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;700&family=Roboto+Condensed:wght@400;700&family=Great+Vibes&family=Tahoma:wght@400;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- CRITICAL: Polyfill for process/env before app loads to prevent White Screen on Android -->
    <script>
      window.process = { env: { API_KEY: '' } };
    </script>

    <!-- Changed to relative path ./index.js -->
    <script type="module" src="./index.js" defer></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@500&family=Space+Mono&display=swap');

        /* --- Base System & Fallbacks --- */
        :root {
            --font-family-system: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --font-family-data: "Courier Prime", monospace;
            --primary-hue: 217;
            --danger-hue: 0;
            --shadow-color-value: rgba(0, 0, 0, 0.7);
            --header-font-size: 2.25rem;
            --header-font-weight: 700;
            --header-glow-intensity: 10px;
        }

        /* --- ANIMATIONS --- */
        @keyframes modal-pop {
            0% { opacity: 0; transform: scale(0.95) translateY(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        @keyframes sheet-slide-up {
            0% { transform: translateY(100%); }
            100% { transform: translateY(0); }
        }
        
        @keyframes emerge-up {
            0% { opacity: 0; transform: translateY(20px) scale(0.9); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes fade-in-backdrop {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .animate-modal-enter { 
            animation: modal-pop 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; 
        }
        
        .animate-sheet-enter {
            animation: sheet-slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        .animate-emerge-up {
            animation: emerge-up 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        }
        
        @keyframes wave { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(1.5); } }

        .animate-fade-in-backdrop {
            animation: fade-in-backdrop 0.3s ease-out forwards;
        }

        /* --- TEMA DEEP BLACK (OLED) --- */
        :root[data-theme="deep-black"] {
          --bg-gradient: none;
          --bg-color: #000000;
          --text-color: #FFFFFF;
          --text-color-darker: #9E9E9E;
          --primary-color: hsl(var(--primary-hue), 91%, 60%);
          --primary-gradient: var(--primary-color);
          --card-bg-main: #000000;
          --card-bg-light: #111111;
          --card-nested-bg: #111111;
          --card-border: #222222;
          --card-hover-border: var(--primary-color);
          --card-glow: none;
          --card-box-shadow: none;
          --card-backdrop-filter: none;
          --theme-card-border-radius: 0.75rem;
          --header-bg-color: #000000;
          --header-backdrop-filter: none;
          --header-border-color: var(--card-border);
          
          /* TAB BAR: SOLID BLACK */
          --tab-bar-bg-color: #000000;
          --tab-bar-backdrop-filter: none;
          --tab-bar-border-color: #222222;
          --tab-bar-box-shadow: 0 -1px 0 #222222;

          --modal-backdrop-bg-color: rgba(0,0,0,0.8);
          --modal-backdrop-filter: none;
          --bottom-sheet-bg: #000000;
          --success-color: #22c55e;
          --success-gradient: var(--success-color);
          --danger-color: #ef4444;
          --danger-gradient: var(--danger-color);
        }

        /* --- Default Theme (MODIFIED TO PURE BLACK) --- */
        :root:not([data-theme]), :root[data-theme="default"] {
            /* Black Background */
            --bg-gradient: none;
            --bg-color: #000000;
            
            --text-color: #F1F5F9;
            --text-color-darker: #9ca3af;
            --primary-color: hsl(var(--primary-hue), 91%, 60%);
            --primary-gradient: linear-gradient(135deg, hsl(var(--primary-hue), 91%, 60%), hsl(var(--primary-hue), 71%, 50%));
            
            /* Cards keep glass look but adapted for black bg */
            --card-bg-main: rgba(20, 20, 20, 0.6);
            --card-bg-light: rgba(30, 30, 30, 0.7);
            --card-nested-bg: rgba(10, 10, 10, 0.6);
            --card-border: rgba(255, 255, 255, 0.08);
            --card-hover-border: hsla(var(--primary-hue), 91%, 60%, 0.6);
            --card-glow: 0 0 45px hsla(var(--primary-hue), 85%, 60%, 0.1);
            --card-box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7);
            --card-backdrop-filter: blur(40px);
            --theme-card-border-radius: 1.25rem;
            
            --header-bg-color: rgba(0, 0, 0, 0.8);
            --header-backdrop-filter: blur(12px);
            --header-border-color: var(--card-border);
            
            /* TAB BAR: SOLID BLACK OVERRIDE */
            --tab-bar-bg-color: #000000;
            --tab-bar-backdrop-filter: none;
            --tab-bar-border-color: rgba(255, 255, 255, 0.08);
            --tab-bar-box-shadow: 0 -1px 0 rgba(255, 255, 255, 0.08);
            
            --modal-backdrop-bg-color: rgba(0,0,0,0.8);
            --modal-backdrop-filter: blur(8px);
            --bottom-sheet-bg: #151515;
            --success-color: #22c55e;
            --success-gradient: linear-gradient(135deg, #4ade80, #22c55e);
            --danger-color: #ef4444;
            --danger-gradient: linear-gradient(135deg, #f87171, #ef4444);
        }

        html, body {
            height: 100%;
            overflow: hidden;
            overscroll-behavior: none;
        }

        body {
            font-family: var(--font-family-system) !important;
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale;
            background-color: var(--bg-color);
            background-image: var(--bg-gradient);
            background-attachment: fixed;
            transition: background 0.5s ease, color 0.5s ease;
            color: var(--text-color);
            text-shadow: none;
        }
        
        details { overflow: hidden; transition: height 0.3s ease-out, margin 0.3s ease-out, opacity 0.3s ease-out; }
        details[open] summary ~ * { animation: sweep .3s ease-in-out; }
        @keyframes sweep { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } }
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }

        /* ... [Keep existing animations and utilities] ... */

        /* UPDATED: Solid Anchored Tab Bar (Android Style) */
        .tab-bar-card-container {
            background: var(--tab-bar-bg-color);
            -webkit-backdrop-filter: var(--tab-bar-backdrop-filter); 
            backdrop-filter: var(--tab-bar-backdrop-filter);
            border-top: 1px solid var(--tab-bar-border-color);
            box-shadow: var(--tab-bar-box-shadow);
            
            /* Structural Changes for Anchored Layout */
            border-radius: 0;
            border-top-left-radius: 0; 
            border-top-right-radius: 0;
            
            /* Positioning */
            position: fixed;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            width: 100% !important;
            max-width: 100% !important;
            transform: none !important;
            z-index: 60;

            will-change: transform, height;
            transition: height 0.2s ease;
            overflow: visible !important;
            pointer-events: auto;
            
            /* Safe area for iPhone home bar if needed, but usually handled by padding */
            padding-bottom: env(safe-area-inset-bottom);
        }

        .tab-bar-card-container > div {
            pointer-events: auto;
        }

        /* ========================================================= */
        /*  MOTOR DE EXPERIENCIA NATIVA (PWA a App Nativa)         */
        /* ========================================================= */
        
        /* 1. Eliminar comportamientos web globales */
        * {
            -webkit-tap-highlight-color: transparent !important; /* Adi贸s al destello gris en Android al tocar botones */
            -webkit-touch-callout: none; /* Adi贸s al men煤 de "Guardar imagen" en iOS al mantener presionado */
            -webkit-user-select: none; /* Evita que los textos se pongan azules por selecci贸n accidental (iOS/Safari) */
            -ms-user-select: none; /* Evita selecci贸n en Windows */
            user-select: none; /* Estandar */
        }

        /* 2. EXCEPCIN CRTICA: Permitir escribir en los Inputs */
        /* Si no hacemos esto, no podr谩s escribir nada en la app */
        input, textarea, [contenteditable="true"] {
            -webkit-user-select: auto !important;
            -ms-user-select: auto !important;
            user-select: auto !important;
        }

        /* 2.5 ADN Nativo Adicional: Prevenci贸n de Arrastre (Drag & Drop Fantasma) */
        img, a, svg {
            -webkit-user-drag: none !important; /* Evita que las im谩genes sean arrastrables en Safari/Chrome */
            -khtml-user-drag: none !important;
            -moz-user-drag: none !important;
            -o-user-drag: none !important;
            /* La propiedad sin prefijo fue removida para evitar el warning del compilador */
        }

        /* 2.6 Prevenci贸n de reajuste autom谩tico de texto al rotar pantalla */
        html {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        /* 3. Ocultar scrollbars y blindar gestos horizontales */
        .hide-scrollbar::-webkit-scrollbar,
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar,
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* ESTO PREVIENE QUE AL USAR EL CARRUSEL SE DISPARE EL "ATRS" DEL NAVEGADOR */
        .no-scrollbar {
            overscroll-behavior-x: contain; 
            touch-action: pan-x pan-y; /* Ayuda a que el t谩ctil diagonal no se trabe */
        }

        /* 4. V谩lvula de escape para textos copiables */
        /* Usa className="selectable-text" en textos que el usuario S deba poder copiar */
        .selectable-text {
            -webkit-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }

        /* 5. Suavizar el desplazamiento interno */
        html {
            scroll-behavior: smooth;
            overscroll-behavior-y: none; /* Evita el "efecto rebote" blanco del navegador al subir del tope */
        }
    </style>
<script>
    (function() {
      try {
        const storageKey = 'yourprime-settings';
        const settingsJSON = localStorage.getItem(storageKey);
        
        if (settingsJSON) {
          const settings = JSON.parse(settingsJSON);
          const theme = settings.appTheme || 'default';
          const primaryColor = settings.themePrimaryColor;
          
          document.documentElement.dataset.theme = theme;
          
          if (primaryColor) {
            const hexToHue = (H) => {
              if (!H) return 217;
              let r = 0, g = 0, b = 0;
              let hStr = H.startsWith('#') ? H.substring(1) : H;
              if (hStr.length === 3) { r = parseInt(hStr[0] + hStr[0], 16); g = parseInt(hStr[1] + hStr[1], 16); b = parseInt(hStr[2] + hStr[2], 16); }
              else if (hStr.length === 6) { r = parseInt(hStr.substring(0, 2), 16); g = parseInt(hStr.substring(2, 4), 16); b = parseInt(hStr.substring(4, 6), 16); }
              else { return 217; }
              r /= 255; g /= 255; b /= 255;
              const max = Math.max(r, g, b), min = Math.min(r, g, b);
              let h = 0;
              if (max !== min) { const d = max - min; switch (max) { case r: h = (g - b) / d + (g < b ? 6 : 0); break; case g: h = (b - r) / d + 2; break; case b: h = (r - g) / d + 4; break; } h /= 6; }
              return Math.round(h * 360);
            };
            document.documentElement.style.setProperty('--primary-hue', String(hexToHue(primaryColor)));
          }
        }
      } catch (e) {
        console.error('Error applying initial theme:', e);
      }
    })();
  </script>

<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "@google/genai": "https://esm.sh/@google/genai@^1.41.0",
    "recharts": "https://esm.sh/recharts@^3.7.0",
    "html2canvas": "https://esm.sh/html2canvas@^1.4.1",
    "lucide-react": "https://esm.sh/lucide-react@^0.574.0",
    "react-dom": "https://esm.sh/react-dom@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "@capacitor/core": "https://esm.sh/@capacitor/core@^8.1.0",
    "@capacitor/app": "https://esm.sh/@capacitor/app@^8.0.1",
    "@capacitor/local-notifications": "https://esm.sh/@capacitor/local-notifications@^8.0.1",
    "@capacitor/filesystem": "https://esm.sh/@capacitor/filesystem@^8.1.2",
    "@capacitor/share": "https://esm.sh/@capacitor/share@^8.0.1",
    "@capacitor-community/keep-awake": "https://esm.sh/@capacitor-community/keep-awake@^8.0.0",
    "@capacitor/preferences": "https://esm.sh/@capacitor/preferences@^8.0.1",
    "@capacitor-community/native-audio": "https://esm.sh/@capacitor-community/native-audio@^8.0.0",
    "@capacitor/haptics": "https://esm.sh/@capacitor/haptics@^8.0.0",
    "zod": "https://esm.sh/zod@^4.3.6",
    "@capacitor/geolocation": "https://esm.sh/@capacitor/geolocation@^8.1.0",
    "@capacitor/camera": "https://esm.sh/@capacitor/camera@^8.0.1",
    "@capacitor-community/text-to-speech": "https://esm.sh/@capacitor-community/text-to-speech@^8.0.0",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.13.0"
  }
}
</script>
</head>
<body>
    <div id="root"></div>
    <script>
      window.onerror = function(message, source, lineno, colno, error) {
        console.error('Global Error:', message, source, lineno, colno, error);
      };
    </script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('Service Worker registrado con 茅xito para modo Offline', reg.scope))
        .catch(err => console.warn('Error al registrar Service Worker', err));
    });
  }
</script>
</body>
</html>