"""
Tabla de valores nutricionales genéricos por categoría de alimento (por 100g).
Basado en USDA FoodData Central, McCance, BEDCA y rangos típicos por tipo.
Formato OFF: energy-kcal_100g, proteins_100g, carbohydrates_100g, fat_100g, etc.
"""

# Nutriments por categoría: macros + micronutrientes (formato OFF _100g)
# Valores típicos por 100g. Vitaminas en µg excepto C (mg). Minerales en mg.
GENERIC_NUTRITION: dict[str, dict[str, float]] = {
    "helado": {
        "energy-kcal_100g": 207,
        "energy_100g": 866,
        "proteins_100g": 3.5,
        "carbohydrates_100g": 24,
        "fat_100g": 11,
        "saturated-fat_100g": 6.8,
        "monounsaturated-fat_100g": 2.7,
        "polyunsaturated-fat_100g": 0.5,
        "trans-fat_100g": 0,
        "iron_100g": 0.1,
        "calcium_100g": 128,
        "sodium_100g": 80,
        "potassium_100g": 199,
        "magnesium_100g": 14,
        "zinc_100g": 0.4,
        "vitamin-a_100g": 118,
        "vitamin-c_100g": 0.6,
        "vitamin-d_100g": 0.2,
        "vitamin-b12_100g": 0.4,
    },
    "donut": {
        "energy-kcal_100g": 421,
        "energy_100g": 1762,
        "proteins_100g": 5.3,
        "carbohydrates_100g": 51.3,
        "fat_100g": 22.8,
        "saturated-fat_100g": 11.1,
        "monounsaturated-fat_100g": 8.2,
        "polyunsaturated-fat_100g": 2.5,
        "trans-fat_100g": 0,
        "iron_100g": 2.1,
        "calcium_100g": 40,
        "sodium_100g": 477,
        "potassium_100g": 134,
        "magnesium_100g": 18,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0.1,
    },
    "muffin": {
        "energy-kcal_100g": 377,
        "energy_100g": 1578,
        "proteins_100g": 5.4,
        "carbohydrates_100g": 53.4,
        "fat_100g": 16.1,
        "saturated-fat_100g": 2.8,
        "monounsaturated-fat_100g": 6.9,
        "polyunsaturated-fat_100g": 5.4,
        "trans-fat_100g": 0,
        "iron_100g": 1.8,
        "calcium_100g": 44,
        "sodium_100g": 336,
        "potassium_100g": 121,
        "magnesium_100g": 19,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 73,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0.1,
    },
    "pan": {
        "energy-kcal_100g": 265,
        "energy_100g": 1109,
        "proteins_100g": 9.4,
        "carbohydrates_100g": 49.3,
        "fat_100g": 3.2,
        "saturated-fat_100g": 0.7,
        "monounsaturated-fat_100g": 0.8,
        "polyunsaturated-fat_100g": 1.2,
        "trans-fat_100g": 0,
        "iron_100g": 2.7,
        "calcium_100g": 54,
        "sodium_100g": 491,
        "potassium_100g": 115,
        "magnesium_100g": 25,
        "zinc_100g": 0.7,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "carne_curada": {
        "energy-kcal_100g": 250,
        "energy_100g": 1046,
        "proteins_100g": 18,
        "carbohydrates_100g": 0,
        "fat_100g": 20,
        "saturated-fat_100g": 7,
        "monounsaturated-fat_100g": 9,
        "polyunsaturated-fat_100g": 2,
        "trans-fat_100g": 0,
        "iron_100g": 1.5,
        "calcium_100g": 8,
        "sodium_100g": 2080,
        "potassium_100g": 330,
        "magnesium_100g": 18,
        "zinc_100g": 2.5,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0.5,
        "vitamin-b12_100g": 0.8,
    },
    "chocolate": {
        "energy-kcal_100g": 546,
        "energy_100g": 2285,
        "proteins_100g": 4.9,
        "carbohydrates_100g": 61.2,
        "fat_100g": 31.3,
        "saturated-fat_100g": 18.5,
        "monounsaturated-fat_100g": 9.5,
        "polyunsaturated-fat_100g": 1.1,
        "trans-fat_100g": 0,
        "iron_100g": 2.1,
        "calcium_100g": 56,
        "sodium_100g": 24,
        "potassium_100g": 559,
        "magnesium_100g": 146,
        "zinc_100g": 2.0,
        "vitamin-a_100g": 50,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0.3,
    },
    "queso": {
        "energy-kcal_100g": 402,
        "energy_100g": 1682,
        "proteins_100g": 25.7,
        "carbohydrates_100g": 1.4,
        "fat_100g": 33.1,
        "saturated-fat_100g": 21.1,
        "monounsaturated-fat_100g": 8.9,
        "polyunsaturated-fat_100g": 1.0,
        "trans-fat_100g": 0,
        "iron_100g": 0.7,
        "calcium_100g": 721,
        "sodium_100g": 621,
        "potassium_100g": 98,
        "magnesium_100g": 28,
        "zinc_100g": 3.1,
        "vitamin-a_100g": 263,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0.5,
        "vitamin-b12_100g": 0.8,
    },
    "yogur": {
        "energy-kcal_100g": 97,
        "energy_100g": 406,
        "proteins_100g": 3.5,
        "carbohydrates_100g": 11.9,
        "fat_100g": 3.3,
        "saturated-fat_100g": 2.1,
        "monounsaturated-fat_100g": 0.9,
        "polyunsaturated-fat_100g": 0.1,
        "trans-fat_100g": 0,
        "iron_100g": 0.1,
        "calcium_100g": 121,
        "sodium_100g": 36,
        "potassium_100g": 155,
        "magnesium_100g": 12,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 27,
        "vitamin-c_100g": 0.5,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0.4,
    },
    "galleta": {
        "energy-kcal_100g": 502,
        "energy_100g": 2101,
        "proteins_100g": 6.9,
        "carbohydrates_100g": 65.2,
        "fat_100g": 24.0,
        "saturated-fat_100g": 6.0,
        "monounsaturated-fat_100g": 12.0,
        "polyunsaturated-fat_100g": 4.0,
        "trans-fat_100g": 0,
        "iron_100g": 2.9,
        "calcium_100g": 58,
        "sodium_100g": 580,
        "potassium_100g": 130,
        "magnesium_100g": 25,
        "zinc_100g": 0.7,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0.1,
    },
    "cereal": {
        "energy-kcal_100g": 379,
        "energy_100g": 1586,
        "proteins_100g": 7.5,
        "carbohydrates_100g": 84.0,
        "fat_100g": 1.2,
        "saturated-fat_100g": 0.2,
        "monounsaturated-fat_100g": 0.2,
        "polyunsaturated-fat_100g": 0.5,
        "trans-fat_100g": 0,
        "iron_100g": 4.5,
        "calcium_100g": 12,
        "sodium_100g": 795,
        "potassium_100g": 105,
        "magnesium_100g": 27,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 500,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 3.3,
        "vitamin-b12_100g": 1.3,
    },
    "mermelada": {
        "energy-kcal_100g": 278,
        "energy_100g": 1163,
        "proteins_100g": 0.4,
        "carbohydrates_100g": 68.9,
        "fat_100g": 0.1,
        "saturated-fat_100g": 0,
        "monounsaturated-fat_100g": 0,
        "polyunsaturated-fat_100g": 0,
        "trans-fat_100g": 0,
        "iron_100g": 0.4,
        "calcium_100g": 20,
        "sodium_100g": 32,
        "potassium_100g": 77,
        "magnesium_100g": 4,
        "zinc_100g": 0.1,
        "vitamin-a_100g": 56,
        "vitamin-c_100g": 8.8,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "salsa": {
        "energy-kcal_100g": 80,
        "energy_100g": 335,
        "proteins_100g": 1.8,
        "carbohydrates_100g": 18.3,
        "fat_100g": 0.2,
        "saturated-fat_100g": 0,
        "monounsaturated-fat_100g": 0,
        "polyunsaturated-fat_100g": 0,
        "trans-fat_100g": 0,
        "iron_100g": 0.5,
        "calcium_100g": 14,
        "sodium_100g": 1174,
        "potassium_100g": 297,
        "magnesium_100g": 15,
        "zinc_100g": 0.2,
        "vitamin-a_100g": 64,
        "vitamin-c_100g": 7.0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "bebida": {
        "energy-kcal_100g": 42,
        "energy_100g": 176,
        "proteins_100g": 0,
        "carbohydrates_100g": 10.6,
        "fat_100g": 0,
        "saturated-fat_100g": 0,
        "monounsaturated-fat_100g": 0,
        "polyunsaturated-fat_100g": 0,
        "trans-fat_100g": 0,
        "iron_100g": 0,
        "calcium_100g": 10,
        "sodium_100g": 4,
        "potassium_100g": 1,
        "magnesium_100g": 1,
        "zinc_100g": 0,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "carne_fresca": {
        "energy-kcal_100g": 250,
        "energy_100g": 1046,
        "proteins_100g": 26,
        "carbohydrates_100g": 0,
        "fat_100g": 15,
        "saturated-fat_100g": 5.5,
        "monounsaturated-fat_100g": 6.5,
        "polyunsaturated-fat_100g": 1.2,
        "trans-fat_100g": 0,
        "iron_100g": 2.5,
        "calcium_100g": 12,
        "sodium_100g": 72,
        "potassium_100g": 318,
        "magnesium_100g": 24,
        "zinc_100g": 4.5,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0.1,
        "vitamin-b12_100g": 1.2,
    },
    "pescado": {
        "energy-kcal_100g": 116,
        "energy_100g": 485,
        "proteins_100g": 20.4,
        "carbohydrates_100g": 0,
        "fat_100g": 3.7,
        "saturated-fat_100g": 0.8,
        "monounsaturated-fat_100g": 1.2,
        "polyunsaturated-fat_100g": 1.2,
        "trans-fat_100g": 0,
        "iron_100g": 0.5,
        "calcium_100g": 12,
        "sodium_100g": 56,
        "potassium_100g": 384,
        "magnesium_100g": 32,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 30,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 4.2,
        "vitamin-b12_100g": 2.0,
    },
    "huevo": {
        "energy-kcal_100g": 155,
        "energy_100g": 649,
        "proteins_100g": 12.6,
        "carbohydrates_100g": 1.1,
        "fat_100g": 10.6,
        "saturated-fat_100g": 3.3,
        "monounsaturated-fat_100g": 4.1,
        "polyunsaturated-fat_100g": 1.4,
        "trans-fat_100g": 0,
        "iron_100g": 1.8,
        "calcium_100g": 56,
        "sodium_100g": 124,
        "potassium_100g": 138,
        "magnesium_100g": 12,
        "zinc_100g": 1.1,
        "vitamin-a_100g": 160,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 2.0,
        "vitamin-b12_100g": 0.9,
    },
    "arroz": {
        "energy-kcal_100g": 130,
        "energy_100g": 544,
        "proteins_100g": 2.7,
        "carbohydrates_100g": 28.2,
        "fat_100g": 0.3,
        "saturated-fat_100g": 0.1,
        "monounsaturated-fat_100g": 0.1,
        "polyunsaturated-fat_100g": 0.1,
        "trans-fat_100g": 0,
        "iron_100g": 0.2,
        "calcium_100g": 10,
        "sodium_100g": 1,
        "potassium_100g": 35,
        "magnesium_100g": 12,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "pasta": {
        "energy-kcal_100g": 131,
        "energy_100g": 548,
        "proteins_100g": 5.0,
        "carbohydrates_100g": 25.1,
        "fat_100g": 1.1,
        "saturated-fat_100g": 0.2,
        "monounsaturated-fat_100g": 0.1,
        "polyunsaturated-fat_100g": 0.4,
        "trans-fat_100g": 0,
        "iron_100g": 1.3,
        "calcium_100g": 7,
        "sodium_100g": 6,
        "potassium_100g": 44,
        "magnesium_100g": 18,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 0,
        "vitamin-c_100g": 0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "fruta": {
        "energy-kcal_100g": 60,
        "energy_100g": 251,
        "proteins_100g": 0.8,
        "carbohydrates_100g": 15.0,
        "fat_100g": 0.2,
        "saturated-fat_100g": 0,
        "monounsaturated-fat_100g": 0,
        "polyunsaturated-fat_100g": 0,
        "trans-fat_100g": 0,
        "iron_100g": 0.3,
        "calcium_100g": 6,
        "sodium_100g": 1,
        "potassium_100g": 195,
        "magnesium_100g": 7,
        "zinc_100g": 0.1,
        "vitamin-a_100g": 54,
        "vitamin-c_100g": 13.7,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "verdura": {
        "energy-kcal_100g": 35,
        "energy_100g": 146,
        "proteins_100g": 2.0,
        "carbohydrates_100g": 7.0,
        "fat_100g": 0.2,
        "saturated-fat_100g": 0,
        "monounsaturated-fat_100g": 0,
        "polyunsaturated-fat_100g": 0,
        "trans-fat_100g": 0,
        "iron_100g": 0.7,
        "calcium_100g": 30,
        "sodium_100g": 65,
        "potassium_100g": 250,
        "magnesium_100g": 15,
        "zinc_100g": 0.3,
        "vitamin-a_100g": 469,
        "vitamin-c_100g": 18.0,
        "vitamin-d_100g": 0,
        "vitamin-b12_100g": 0,
    },
    "genérico": {
        "energy-kcal_100g": 150,
        "energy_100g": 628,
        "proteins_100g": 5.0,
        "carbohydrates_100g": 20.0,
        "fat_100g": 5.0,
        "saturated-fat_100g": 1.5,
        "monounsaturated-fat_100g": 2.0,
        "polyunsaturated-fat_100g": 1.0,
        "trans-fat_100g": 0,
        "iron_100g": 0.8,
        "calcium_100g": 50,
        "sodium_100g": 200,
        "potassium_100g": 150,
        "magnesium_100g": 20,
        "zinc_100g": 0.5,
        "vitamin-a_100g": 50,
        "vitamin-c_100g": 5.0,
        "vitamin-d_100g": 0.2,
        "vitamin-b12_100g": 0.2,
    },
}

# Keywords (lowercase) -> categoría. Orden: más específicos primero.
CATEGORY_KEYWORDS: list[tuple[list[str], str]] = [
    (["glace", "ice cream", "helado", "sorbet", "gelato"], "helado"),
    (["donut", "doughnut", "beignet"], "donut"),
    (["muffin", "cupcake"], "muffin"),
    (["pain", "bread", "pan", "baguette", "brioche", "baguettine", "constance", "envoûtante", "lin"], "pan"),
    (["lomo", "jamón", "jamon", "chorizo", "salchichón", "saucisson", "bacon", "prosciutto", "serrano", "ibérico", "iberico"], "carne_curada"),
    (["chocolate", "cacao", "coco"], "chocolate"),
    (["fromage", "queso", "cheese", "camembert", "brie"], "queso"),
    (["yogurt", "yogur", "yaourt"], "yogur"),
    (["galleta", "cookie", "biscuit", "cracker", "shortbread"], "galleta"),
    (["cereal", "corn flakes", "muesli", "granola"], "cereal"),
    (["mermelada", "jam", "confit", "marmelade", "confiture"], "mermelada"),
    (["salsa", "sauce", "ketchup", "mayo", "mayonnaise"], "salsa"),
    (["boisson", "bebida", "drink", "soda", "jus", "juice", "refresco"], "bebida"),
    (["viande", "carne", "meat", "steak", "beef", "pork", "poulet", "pollo"], "carne_fresca"),
    (["poisson", "fish", "pescado", "saumon", "salmón", "tuna", "atún"], "pescado"),
    (["oeuf", "huevo", "egg"], "huevo"),
    (["riz", "arroz", "rice"], "arroz"),
    (["pasta", "spaghetti", "nouille", "noodle"], "pasta"),
    (["fruit", "fruta", "fraise", "apple", "manzana", "banana", "orange"], "fruta"),
    (["légume", "verdura", "vegetable", "tomate", "tomato", "carotte", "zanahoria"], "verdura"),
]


def infer_category(product_name: str) -> str:
    """Infiere categoría a partir del nombre del producto."""
    import unicodedata
    if not product_name or not isinstance(product_name, str):
        return "genérico"
    n = unicodedata.normalize("NFD", product_name.lower().strip())
    n = "".join(c for c in n if unicodedata.category(c) != "Mn")
    for keywords, cat in CATEGORY_KEYWORDS:
        for kw in keywords:
            if kw in n:
                return cat
    return "genérico"


def get_generic_nutriments(category: str) -> dict[str, float]:
    """Devuelve nutriments genéricos para la categoría."""
    return dict(GENERIC_NUTRITION.get(category, GENERIC_NUTRITION["genérico"]))
